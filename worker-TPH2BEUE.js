addEventListener("message",({data:o})=>{let s=o.normalizedCumulatedTimeLaps,u=o.shadowLaps,i=o.futureLaps,t=o.driverNamesByRaceNumber,e=o.raceConfig,n=o.lapConfig.referenceRaceNumber,r=e.gapChartConfig.lapWindow,c=b(s,u,r,n),m=w(c,t);postMessage({chartData:m})});function b(o,s,u,i){let t=new Map,e=[],a=0;if(i&&o.has(i)){let n=o.get(i);a=n!==void 0?n.length-u:0}else{let n=Number.MAX_VALUE;o.forEach(r=>{n=Math.min(n,r.length)}),a=n-u}return a<=0?{cumulatedTimeLapsWindow:o,startLapNumber:0,shadowTimeLapsWindow:s}:(o.forEach((n,r)=>{if(n.length>a){let c=n.slice(a);t.set(r,c)}}),s.forEach(n=>{if(n.startLapNumber>=a)e.push({startLapNumber:n.startLapNumber,cumulatedTimeLaps:t});else{let r=a,c=new Map;n.cumulatedTimeLaps.forEach((m,d)=>{let g=m.slice(a-n.startLapNumber);c.set(d,g)}),e.push({startLapNumber:r,cumulatedTimeLaps:c})}}),{cumulatedTimeLapsWindow:t,startLapNumber:a,shadowTimeLapsWindow:e})}function w(o,s){let u=[];return o.cumulatedTimeLapsWindow.forEach((i,t)=>{let e=l(t),a=l(t,.2),n=s.has(t)?" - "+s.get(t):"",r=t+n,c={data:h(i,o.startLapNumber),label:r,backgroundColor:a,borderColor:e,pointBackgroundColor:e,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:e,showLine:!0};u.push(c)}),o.shadowTimeLapsWindow.forEach(i=>{i.cumulatedTimeLaps.forEach((t,e)=>{let a=s.has(e)?" - "+s.get(e):"",n="Shadow - "+e+a,r={data:h(t,i.startLapNumber),label:n,backgroundColor:"gray",borderColor:"gray",pointBackgroundColor:"gray",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"gray",showLine:!0};u.push(r)})}),{datasets:u}}function h(o,s){let u=[];return o.forEach((i,t)=>{u.push({x:t+s,y:i})}),u}function l(o,s=1){let t=(o*.33797+.618033988749895)%1,e=.7,a=.5,n=(f,L,p)=>(p<0&&(p+=1),p>1&&(p-=1),p<1/6?f+(L-f)*6*p:p<1/2?L:p<2/3?f+(L-f)*(2/3-p)*6:f),r=a<.5?a*(1+e):a+e-a*e,c=2*a-r,m=Math.round(n(c,r,t+1/3)*255),d=Math.round(n(c,r,t)*255),g=Math.round(n(c,r,t-1/3)*255);return`rgba(${m}, ${d}, ${g}, ${s})`}
