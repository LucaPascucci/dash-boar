addEventListener("message",({data:a})=>{let e=a.lapConfig,t=[...a.laps.values()],n=e.referenceRaceNumber,m=f(t),c=N(t),s=d(t,e),u=L(c),o=b(u,n),i=l(u,o);postMessage({paces:s,cumulatedTimeLaps:i,driverNamesByRaceNumber:m,normalizedCumulatedTimeLaps:i,referenceRaceNumberAverageTime:o})});function l(a,e){if(e===0)return a;let r=new Map;return a.forEach((t,n)=>{let m=t.map((c,s)=>s*e-c);r.set(n,m)}),r}function b(a,e){if(a.has(e)){let r=a.get(e);return r&&r.length>0?r[r.length-1]/(r.length-1):0}return 0}function f(a){let e=new Map;return a.forEach(r=>{e.has(r.raceNumber)||e.set(r.raceNumber,r.driverName)}),e}function L(a){let e=new Map;return a.forEach((r,t)=>{let n=r.sort((s,u)=>s.lapNumber-u.lapNumber),m=[];m.push(0);let c=0;n.forEach(s=>{c+=s.lapMilliseconds,m.push(c)}),e.set(t,m)}),e}function N(a){let e=new Map;return a.forEach(r=>{e.has(r.raceNumber)||e.set(r.raceNumber,[]),e.get(r.raceNumber)?.push(r)}),e}function d(a,e){let r=new Map,t=new Map;return a.filter(n=>!n.pitStop&&!n.deleted).forEach(n=>{t.has(n.raceNumber)||t.set(n.raceNumber,[]),t.get(n.raceNumber)?.push(n)}),t.forEach((n,m)=>{let s=n.filter(u=>!u.pitStop&&u.lapMilliseconds<e.paceLapThresholdMilliseconds).sort((u,o)=>o.lapNumber-u.lapNumber).slice(0,e.paceLapNumber);if(s.length>0){let o=s.reduce((i,p)=>i+p.lapMilliseconds,0)/s.length;r.set(m,o)}}),r}
