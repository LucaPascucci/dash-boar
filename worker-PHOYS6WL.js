addEventListener("message",({data:e})=>{let a=e.cumulatedTimeLaps,r=e.normalizedCumulatedTimeLaps,n=e.referenceRaceNumberAverageTime,u=e.paces,t=e.lastLapNumberByRaceNumber,i=e.lapConfig,s=e.lapSimulatorConfig,m=i.referenceRaceNumber,o=M(r,n,m,t),c=h(a,u,s);postMessage({shadowLaps:o,futureLaps:c})});function M(e,a,r,n){let u=[],t=n.get(r);return t&&e.forEach((i,s)=>{if(r!==s){let m=n.get(s);if(m&&m!==t){let o=t-m,c=g(i,a,o);u.push({cumulatedTimeLaps:new Map([[s,c]]),startLapNumber:o>=0?o:0})}}}),u}function g(e,a,r){let n=[];return r<0&&(e=e.slice(Math.abs(r))),e.forEach(u=>{n.push(u+a*r)}),n}function h(e,a,r){let n=new Map,u=e;for(let t=0;t<r.simulatedLaps;t++){let i=d(e),s=L(i),m=T(i,a),o=L(m),c=new Map;s.forEach((l,p)=>{let b=o.get(p);if(b){if(b===l){let f=m.get(p);f&&(f&&!n.has(p)&&n.set(p,[f]),n.get(p)?.push(f))}b<l,b>l}})}return[]}function d(e){let a=new Map;return e.forEach((r,n)=>{a.set(n,r[r.length-1])}),a}function L(e){let a=new Map,r=[];return e.forEach((n,u)=>{r.push({raceNumber:u,totalLapTimeMilliseconds:n})}),r.sort((n,u)=>u.totalLapTimeMilliseconds-n.totalLapTimeMilliseconds),r.forEach((n,u)=>{a.set(n.raceNumber,u+1)}),a}function T(e,a){let r=new Map;return e.forEach((n,u)=>{let t=a.get(u)||0;r.set(u,n+t)}),r}
