addEventListener("message",({data:t})=>{let u=t.normalizedCumulatedTimeLaps,p=t.shadowLaps,i=t.futureLaps,a=t.driverNamesByRaceNumber,r=t.gapChartConfig,n=t.lapConfig.referenceRaceNumber,e=r.lapWindow,s=b(u,p,e,n),f=C(s,a,i);postMessage({chartData:f})});function b(t,u,p,i){let a=new Map,r=[],o=0;if(i&&t.has(i)){let n=t.get(i);o=n!==void 0?n.length-p:0}else{let n=Number.MAX_VALUE;t.forEach(e=>{n=Math.min(n,e.length)}),o=n-p}return o<=0?{cumulatedTimeLapsWindow:t,startLapNumber:0,shadowTimeLapsWindow:u}:(t.forEach((n,e)=>{if(n.length>o){let s=n.slice(o);a.set(e,s)}}),u.forEach(n=>{if(n.startLapNumber>=o)r.push({startLapNumber:n.startLapNumber,cumulatedTimeLaps:a});else{let e=o,s=new Map;n.cumulatedTimeLaps.forEach((f,d)=>{let g=f.slice(o-n.startLapNumber);s.set(d,g)}),r.push({startLapNumber:e,cumulatedTimeLaps:s})}}),{cumulatedTimeLapsWindow:a,startLapNumber:o,shadowTimeLapsWindow:r})}function C(t,u,p){let i=[];return t.cumulatedTimeLapsWindow.forEach((a,r)=>{let o=L(r),n=L(r,.2),e=u.has(r)?" - "+u.get(r):"",s=r+e,f={data:l(a,t.startLapNumber),label:s,backgroundColor:n,borderColor:o,pointBackgroundColor:o,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:o,showLine:!0};i.push(f)}),t.shadowTimeLapsWindow.forEach(a=>{a.cumulatedTimeLaps.forEach((r,o)=>{let n=u.has(o)?" - "+u.get(o):"",e="SHADOW - "+o+n,s={data:l(r,a.startLapNumber),label:e,backgroundColor:"gray",borderColor:"gray",pointBackgroundColor:"gray",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"gray",showLine:!0};i.push(s)})}),p.forEach(a=>{a.cumulatedTimeLaps.forEach((r,o)=>{let n=u.has(o)?" - "+u.get(o):"",e="FUTURE - "+o+n,s={data:l(r,a.startLapNumber),label:e,backgroundColor:"gray",borderColor:"gray",pointBackgroundColor:"gray",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"gray",showLine:!0};i.push(s)})}),{datasets:i}}function l(t,u){let p=[];return t.forEach((i,a)=>{p.push({x:a+u,y:i})}),p}function L(t,u=1){let a=(t*.33797+.618033988749895)%1,r=.7,o=.5,n=(m,h,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<1/6?m+(h-m)*6*c:c<1/2?h:c<2/3?m+(h-m)*(2/3-c)*6:m),e=o<.5?o*(1+r):o+r-o*r,s=2*o-e,f=Math.round(n(s,e,a+1/3)*255),d=Math.round(n(s,e,a)*255),g=Math.round(n(s,e,a-1/3)*255);return`rgba(${f}, ${d}, ${g}, ${u})`}
