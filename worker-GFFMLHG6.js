addEventListener("message",({data:o})=>{let s=o.normalizedCumulatedTimeLaps,u=o.shadowLaps,i=o.futureLaps,t=o.driverNamesByRaceNumber,r=o.gapChartConfig,n=o.lapConfig.referenceRaceNumber,e=r.lapWindow,c=b(s,u,e,n),m=w(c,t);postMessage({chartData:m})});function b(o,s,u,i){let t=new Map,r=[],a=0;if(i&&o.has(i)){let n=o.get(i);a=n!==void 0?n.length-u:0}else{let n=Number.MAX_VALUE;o.forEach(e=>{n=Math.min(n,e.length)}),a=n-u}return a<=0?{cumulatedTimeLapsWindow:o,startLapNumber:0,shadowTimeLapsWindow:s}:(o.forEach((n,e)=>{if(n.length>a){let c=n.slice(a);t.set(e,c)}}),s.forEach(n=>{if(n.startLapNumber>=a)r.push({startLapNumber:n.startLapNumber,cumulatedTimeLaps:t});else{let e=a,c=new Map;n.cumulatedTimeLaps.forEach((m,d)=>{let h=m.slice(a-n.startLapNumber);c.set(d,h)}),r.push({startLapNumber:e,cumulatedTimeLaps:c})}}),{cumulatedTimeLapsWindow:t,startLapNumber:a,shadowTimeLapsWindow:r})}function w(o,s){let u=[];return o.cumulatedTimeLapsWindow.forEach((i,t)=>{let r=l(t),a=l(t,.2),n=s.has(t)?" - "+s.get(t):"",e=t+n,c={data:L(i,o.startLapNumber),label:e,backgroundColor:a,borderColor:r,pointBackgroundColor:r,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:r,showLine:!0};u.push(c)}),o.shadowTimeLapsWindow.forEach(i=>{i.cumulatedTimeLaps.forEach((t,r)=>{let a=s.has(r)?" - "+s.get(r):"",n="Shadow - "+r+a,e={data:L(t,i.startLapNumber),label:n,backgroundColor:"gray",borderColor:"gray",pointBackgroundColor:"gray",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"gray",showLine:!0};u.push(e)})}),{datasets:u}}function L(o,s){let u=[];return o.forEach((i,t)=>{u.push({x:t+s,y:i})}),u}function l(o,s=1){let t=(o*.33797+.618033988749895)%1,r=.7,a=.5,n=(f,g,p)=>(p<0&&(p+=1),p>1&&(p-=1),p<1/6?f+(g-f)*6*p:p<1/2?g:p<2/3?f+(g-f)*(2/3-p)*6:f),e=a<.5?a*(1+r):a+r-a*r,c=2*a-e,m=Math.round(n(c,e,t+1/3)*255),d=Math.round(n(c,e,t)*255),h=Math.round(n(c,e,t-1/3)*255);return`rgba(${m}, ${d}, ${h}, ${s})`}
