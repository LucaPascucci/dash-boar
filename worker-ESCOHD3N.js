addEventListener("message",({data:t})=>{let r=t.cumulatedTimeLaps,u=t.driverNamesByRaceNumber,i=t.raceConfig,a=h(r,i),n=L(a,u);postMessage({chartData:n})});function h(t,r){let u=new Map,i=r!==void 0?r.gapChartConfig.lapWindow:5,a=r!==void 0?r.gapChartConfig.referenceRaceNumber:void 0,n=0;if(a&&t.has(a)){let e=t.get(a);n=e!==void 0?e.length-i:0}else{let e=Number.MAX_VALUE;t.forEach(o=>{e=Math.min(e,o.length)}),n=e-i}return n<=0?{cumulatedTimeLapsWindow:t,startLapNumber:0}:(t.forEach((e,o)=>{if(e.length>n){let c=e.slice(n);u.set(o,c)}}),{cumulatedTimeLapsWindow:u,startLapNumber:n})}function L(t,r){let u=[],i=[],a=0;t.cumulatedTimeLapsWindow.forEach(n=>{a=Math.max(a,n.length)});for(let n=t.startLapNumber;n<t.startLapNumber+a;n++)u.push(n.toString());return t.cumulatedTimeLapsWindow.forEach((n,e)=>{let o=p(e),c=p(e,.2),d=r.has(e)?" - "+r.get(e):"",l=e+d,f={data:n,label:l,backgroundColor:c,borderColor:o,pointBackgroundColor:o,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:o,fill:!1};i.push(f)}),{datasets:i,labels:u}}function p(t,r=1){let a=(t*.33797+.618033988749895)%1,n=.7,e=.5,o=(m,g,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?m+(g-m)*6*s:s<1/2?g:s<2/3?m+(g-m)*(2/3-s)*6:m),c=e<.5?e*(1+n):e+n-e*n,d=2*e-c,l=Math.round(o(d,c,a+1/3)*255),f=Math.round(o(d,c,a)*255),b=Math.round(o(d,c,a-1/3)*255);return`rgba(${l}, ${f}, ${b}, ${r})`}
