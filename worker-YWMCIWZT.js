addEventListener("message",({data:s})=>{let e=s.lapConfig,t=[...s.laps.values()],a=l(t),u=L(t),c=f(t,e),n=N(u),m=i(u);postMessage({paces:c,cumulatedTimeLaps:n,driverNamesByRaceNumber:a,lastLapNumberByRaceNumber:m})});function i(s){let e=new Map;return s.forEach((r,t)=>{if(r.length>0){let a=r.sort((u,c)=>c.lapNumber-u.lapNumber);e.set(t,a[0].lapNumber)}}),e}function l(s){let e=new Map;return s.forEach(r=>{e.has(r.raceNumber)||e.set(r.raceNumber,r.driverName)}),e}function N(s){let e=new Map;return s.forEach((r,t)=>{let a=r.sort((n,m)=>n.lapNumber-m.lapNumber),u=[];u.push(0);let c=0;a.forEach(n=>{c+=n.lapMilliseconds,u.push(c)}),e.set(t,u)}),e}function L(s){let e=new Map;return s.forEach(r=>{e.has(r.raceNumber)||e.set(r.raceNumber,[]),e.get(r.raceNumber)?.push(r)}),e}function f(s,e){let r=new Map,t=new Map;return s.filter(a=>!a.pitStop&&!a.deleted).forEach(a=>{t.has(a.raceNumber)||t.set(a.raceNumber,[]),t.get(a.raceNumber)?.push(a)}),t.forEach((a,u)=>{let n=a.filter(m=>!m.pitStop&&m.lapMilliseconds<e.paceLapThresholdMilliseconds).sort((m,p)=>p.lapNumber-m.lapNumber).slice(0,e.paceLapNumber);if(n.length>0){let p=n.reduce((o,b)=>o+b.lapMilliseconds,0)/n.length;r.set(u,p)}}),r}
