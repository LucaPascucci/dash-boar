addEventListener("message",({data:u})=>{let r=u.cumulatedTimeLaps,e=u.normalizedCumulatedTimeLaps,n=u.referenceRaceNumberAverageTime,a=u.lapSimulatorConfig,t=u.paces,s=L(e,n,a),m=d(r,t,a);postMessage({shadowLaps:s,futureLaps:m})});function L(u,r,e){let n=[];for(let a=1;a<=e.shadowLaps;a++)n.push(M(u,r,-Math.abs(a)));return n}function M(u,r,e){let n=new Map;return u.forEach((a,t)=>{let s=[],m=a;e<0&&(m=m.slice(Math.abs(e))),m.forEach(i=>{s.push(i+r*e)}),n.set(t,s)}),{cumulatedTimeLaps:n,startLapNumber:e>=0?e:0}}function d(u,r,e){let n=new Map,a=u;for(let t=0;t<e.simulatedLaps;t++){let s=h(u),m=l(s),i=T(s,r),f=l(i),g=new Map;m.forEach((b,o)=>{let p=f.get(o);if(p){if(p===b){let c=i.get(o);c&&(c&&!n.has(o)&&n.set(o,[c]),n.get(o)?.push(c))}p<b,p>b}})}return[]}function h(u){let r=new Map;return u.forEach((e,n)=>{r.set(n,e[e.length-1])}),r}function l(u){let r=new Map,e=[];return u.forEach((n,a)=>{e.push({raceNumber:a,totalLapTimeMilliseconds:n})}),e.sort((n,a)=>a.totalLapTimeMilliseconds-n.totalLapTimeMilliseconds),e.forEach((n,a)=>{r.set(n.raceNumber,a+1)}),r}function T(u,r){let e=new Map;return u.forEach((n,a)=>{let t=r.get(a)||0;e.set(a,n+t)}),e}
