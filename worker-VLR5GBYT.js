addEventListener("message",({data:o})=>{let u=o.cumulatedTimeLaps,s=o.shadowLaps,i=o.driverNamesByRaceNumber,e=o.raceConfig,t=b(u,s,e),r=w(t,i);postMessage({chartData:r})});function b(o,u,s){let i=new Map,e=[],t=s!==void 0?s.gapChartConfig.lapWindow:5,r=s!==void 0?s.gapChartConfig.referenceRaceNumber:void 0,a=0;if(r&&o.has(r)){let n=o.get(r);a=n!==void 0?n.length-t:0}else{let n=Number.MAX_VALUE;o.forEach(c=>{n=Math.min(n,c.length)}),a=n-t}return a<=0?{cumulatedTimeLapsWindow:o,startLapNumber:0,shadowTimeLapsWindow:u}:(o.forEach((n,c)=>{if(n.length>a){let p=n.slice(a);i.set(c,p)}}),u.forEach(n=>{if(n.startLapNumber>=a)e.push({startLapNumber:n.startLapNumber,cumulatedTimeLaps:i});else{let c=a,p=new Map;n.cumulatedTimeLaps.forEach((f,l)=>{let m=f.slice(a-n.startLapNumber);p.set(l,m)}),e.push({startLapNumber:c,cumulatedTimeLaps:p})}}),{cumulatedTimeLapsWindow:i,startLapNumber:a,shadowTimeLapsWindow:e})}function w(o,u){let s=[];return o.cumulatedTimeLapsWindow.forEach((i,e)=>{let t=L(e),r=L(e,.2),a=u.has(e)?" - "+u.get(e):"",n=e+a,c={data:g(i,o.startLapNumber),label:n,backgroundColor:r,borderColor:t,pointBackgroundColor:t,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:t,showLine:!0};s.push(c)}),o.shadowTimeLapsWindow.forEach(i=>{i.cumulatedTimeLaps.forEach((e,t)=>{let r=u.has(t)?" - "+u.get(t):"",a="Shadow - "+t+r,n={data:g(e,i.startLapNumber),label:a,backgroundColor:"gray",borderColor:"gray",pointBackgroundColor:"gray",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"gray",showLine:!0};s.push(n)})}),{datasets:s}}function g(o,u){let s=[];return o.forEach((i,e)=>{s.push({x:e+u,y:i})}),s}function L(o,u=1){let e=(o*.33797+.618033988749895)%1,t=.7,r=.5,a=(m,h,d)=>(d<0&&(d+=1),d>1&&(d-=1),d<1/6?m+(h-m)*6*d:d<1/2?h:d<2/3?m+(h-m)*(2/3-d)*6:m),n=r<.5?r*(1+t):r+t-r*t,c=2*r-n,p=Math.round(a(c,n,e+1/3)*255),f=Math.round(a(c,n,e)*255),l=Math.round(a(c,n,e-1/3)*255);return`rgba(${p}, ${f}, ${l}, ${u})`}
