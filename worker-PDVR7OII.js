addEventListener("message",({data:t})=>{let n=t.normalizedCumulatedTimeLaps,p=t.shadowLaps,i=t.futureLaps,s=t.driverNamesByRaceNumber,e=t.colorByRaceNumber,a=t.gapChartConfig,r=t.lapSimulatorConfig.referenceRaceNumber,u=a.lapWindow,m=d(n,p,u,r),c=L(m,s,i,e);postMessage({chartData:c})});function d(t,n,p,i){let s=new Map,e=[],a=0;if(i&&t.has(i)){let o=t.get(i);a=o!==void 0?o.length-p:0}else{let o=Number.MAX_VALUE;t.forEach(r=>{o=Math.min(o,r.length)}),a=o-p}return a<=0?{cumulatedTimeLapsWindow:t,startLapNumber:0,shadowTimeLapsWindow:n}:(t.forEach((o,r)=>{if(o.length>a){let u=o.slice(a);s.set(r,u)}}),n.forEach(o=>{if(o.startLapNumber>=a)e.push({startLapNumber:o.startLapNumber,cumulatedTimeLaps:s});else{let r=a,u=new Map;o.cumulatedTimeLaps.forEach((m,c)=>{let l=m.slice(a-o.startLapNumber);u.set(c,l)}),e.push({startLapNumber:r,cumulatedTimeLaps:u})}}),{cumulatedTimeLapsWindow:s,startLapNumber:a,shadowTimeLapsWindow:e})}function L(t,n,p,i){let s=[];return t.cumulatedTimeLapsWindow.forEach((e,a)=>{let o=i.get(a),r=n.has(a)?" - "+n.get(a):"",u=a+r,m={data:f(e,t.startLapNumber),label:u,backgroundColor:o,borderColor:o,pointBackgroundColor:o,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:o,showLine:!0};s.push(m)}),t.shadowTimeLapsWindow.forEach(e=>{e.cumulatedTimeLaps.forEach((a,o)=>{let r=n.has(o)?" - "+n.get(o):"",u="SHADOW - "+o+r,m={data:f(a,e.startLapNumber),label:u,backgroundColor:"gray",borderColor:"gray",pointBackgroundColor:"gray",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"gray",showLine:!0};s.push(m)})}),p.forEach(e=>{e.cumulatedTimeLaps.forEach((a,o)=>{let r=i.get(o),u=n.has(o)?" - "+n.get(o):"",m="FUTURE - "+o+u,c={data:f(a,e.startLapNumber),label:m,backgroundColor:"gray",borderColor:r,pointBackgroundColor:"gray",pointBorderColor:"#fff",pointHoverBackgroundColor:r,pointHoverBorderColor:"gray",borderDash:[5,5],showLine:!0};s.push(c)})}),{datasets:s}}function f(t,n){let p=[];return t.forEach((i,s)=>{p.push({x:s+n,y:i})}),p}
